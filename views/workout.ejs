<link rel="stylesheet" href="/css/workout/styles.css">




<main>
  <div class="container">
    <form class="formulary" action="/workout?_method=PUT" method="POST">
      <div class="title-box">
        <h2 class="title"><%= routine.title %></h2>
        <div class="buttons">
          <button class="btn submit" type="submit">Finish Workout</button>
          <button class="btn cancel" type="reset" onclick="window.location.href = '/routines'">Cancel Workout</button>
        </div>
      </div>

      <!-- Inputs para mandar datos de record -->
      <input hidden name="workouts" value="<%= record.workouts.total + 1 %>">
      <input hidden name="workout_date" value="<%= new Date() %>">

      <div class="exercises-container">
        <!-- Cada ejercicio con sus formularios de registro -->
        <% for (let i = 0; i < routine.exercises.length; i++) { %> 
          <div class="exercise-box">
            <div class="intro-section">
              <h3 class="section-title"><%= routine.exercises[i].name %></h3>
            </div>
            <!-- Informaicon del ejercicio -->
            <div class="exercise-info">
              <div class="note-info" >
                <p class="note"><%= routine.exercises[i].note %></p>
              </div>
              <% if (routine.exercises[i].rest !== '') { %> 
                <div class="rest-info">
                  <svg class="time-svg" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" ><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M13 7h-2v5.414l3.293 3.293 1.414-1.414L13 11.586z"></path></svg>
                  <p class="rest-data"><span><%= routine.exercises[i].rest %>'</span></p>
                </div>
              <% } %>
            </div>

            <!-- Inputs hidden para pasar datos de la rutuna -->
            <input hidden name="name" value="<%= routine.exercises[i].name %>">
            <input hidden name="class" value="<%= routine.exercises[i].class %>">
            <input hidden name="main_muscle" value="<%= routine.exercises[i].mainMuscle %>">
            <input hidden name="exercises_sets" value="<%= routine.exercises[i].sets %>">

            <!-- Input para crear una nota -->
            <div class="note-input-box">
              <input autocomplete="off" class="note-input" type="text" name="note" placeholder="Add notes here...">
            </div>


            <!-- Definir la unidad del ejercicio correspondiente -->
            <% let unit = '' %>
            <% if (routine.exercises[i].class === "REPS/WEIGHT" || routine.exercises[i].class === "REPS") { %>       
              <% unit = 'Reps' %>
            <% } else { %>
              <% unit = 'Segs' %>
            <% } %>

            <% let secondUnit = '' %>
            <% if (routine.exercises[i].class === "REPS/WEIGHT" || routine.exercises[i].class === "DUR/WEIGHT") { %>       
              <% secondUnit = 'kg' %>
            <% } else { %>
              <% secondUnit = 'm' %>
            <% } %>
            <div class="register-box">
              <div class="table-title">
                <p class="table-label">Set</p>
                <p class="table-label">Previous</p>
                <!-- Definir si es ejericio de un dato o de dos, y cual es el segundo dato -->
                <% let isSecondData = false %>
                <% if (routine.exercises[i].class === "REPS/WEIGHT" || routine.exercises[i].class === "DUR/WEIGHT") { %>  
                  <p class="table-label">Kg</p>
                  <% isSecondData = true %>
                <% } else if (routine.exercises[i].class === "DIST/DUR") { %>
                  <p class="table-label">Dist</p>
                  <% isSecondData = true %>
                <% } %>
                <p class="table-label main-label"><%= unit %></p>
              </div>

              <!-- Display de la tabla de registro segun el numero de sets del ejercicio -->
              <% let setsNum = routine.exercises[i].sets %>
              <% for (let y = 0; y < setsNum; y++) { %> 
                <!-- Definir si la fila es par para aÃ±adirle un color -->
                <% let isRowOdd = 'even' %>
                <% if (y % 2 === 0) isRowOdd = 'odd' %>
                <div class="set-row <%=isRowOdd%>">
                  <p class="set-number"><%= y + 1 %></p>

                  <!-- Manejo del dato previo (still testing) -->
                  <% if (record.exercises.find(v => v.name === routine.exercises[i].name)) {  %>
                    
                    <% let exerciseObject = record.exercises.filter(v => v.name === routine.exercises[i].name) %>
                    <% let prevDataSets = exerciseObject[0].setsIndex[exerciseObject[0].setsIndex.length - 1] - exerciseObject[0].setsIndex[exerciseObject[0].setsIndex.length - 2] %>
                    <% if (y < prevDataSets) { %>
                      <% if (isSecondData) { %> 
                        <p class="previous-data"><%= exerciseObject[0].secondData[exerciseObject[0].secondData.length - 1 - y] %><%= secondUnit %> x <%= exerciseObject[0].mainData[exerciseObject[0].mainData.length - 1 - y] %></p>
                      <% } else { %>
                        <p class="previous-data"><%= exerciseObject[0].mainData[exerciseObject[0].mainData.length - 1 - y] %></p>
                      <% } %>
                    <% } else { %> 
                      <p class="previous-data">0</p>
                    <% } %>
                  <% } else { %>
                    <p class="previous-data">0</p>
                  <% } %>
          



                  <!-- Inputs de registro -->
                  <% if (isSecondData) { %> 
                    <input autocomplete="off" placeholder="-" type="text" name="secondData" class="input input-conditional" onkeypress="isNumber(event)" min="0">
                  <% } else { %>
                    <input autocomplete="off" value="0" style="display: none;" placeholder="-" type="text" name="secondData" class="input input-conditional" onkeypress="isNumber(event)" min="0">
                  <% } %>
                  <input autocomplete="off" placeholder="-" type="text" name="mainData" class="input main-input" onkeypress="isNumber(event)" min="0">
                </div>
              <% } %>
            </div>
          </div>
        <% } %>
      </div>
    </form>

  </div>
</main>





<script src="/js/workout/main.js"></script>